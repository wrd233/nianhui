<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âπ¥‰ºöÁü•ËØÜÈóÆÁ≠î</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* File picker overlay */
        #file-picker-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
        }

        #file-picker-overlay.hidden {
            display: none;
        }

        .picker-content {
            text-align: center;
            color: white;
            padding: 3rem;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .picker-content h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .picker-content p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .select-folder-btn {
            padding: 1rem 2.5rem;
            font-size: 1.3rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .select-folder-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
        }

        #folder-input {
            display: none;
        }

        .error-message {
            color: #ff6b6b;
            margin-top: 1rem;
            font-size: 1.1rem;
        }

        /* Presentation container */
        #presentation-container {
            display: none;
            width: 100%;
            height: 100%;
        }

        #presentation-container.active {
            display: block;
        }

        /* Slide viewport */
        .slide-viewport {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 2rem;
        }

        .slide-wrapper {
            position: relative;
            width: 100%;
            max-width: 1280px;
            aspect-ratio: 16 / 9;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 80px rgba(0, 0, 0, 0.4);
            overflow: hidden;
        }

        /* Slides */
        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 3rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: translateX(100px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            pointer-events: none;
        }

        .slide.active {
            opacity: 1;
            transform: translateX(0);
            pointer-events: auto;
        }

        .slide.prev {
            transform: translateX(-100px);
        }

        /* Cover slide */
        .slide.cover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
        }

        .slide.cover .logo {
            width: 150px;
            height: 150px;
            margin-bottom: 2rem;
            object-fit: contain;
        }

        .slide.cover h1 {
            font-size: 4rem;
            margin-bottom: 1rem;
            font-weight: bold;
        }

        .slide.cover .subtitle {
            font-size: 2rem;
            opacity: 0.9;
        }

        /* Rules slide */
        .slide.rules {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .slide.rules h2 {
            font-size: 3rem;
            margin-bottom: 2rem;
        }

        .slide.rules ul {
            list-style: none;
            font-size: 1.5rem;
            line-height: 2.5;
            max-width: 800px;
        }

        .slide.rules li:before {
            content: "‚úì ";
            margin-right: 0.5rem;
        }

        /* Section intro slide */
        .slide.section-intro {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            text-align: center;
        }

        .slide.section-intro .round-number {
            font-size: 6rem;
            font-weight: bold;
            margin-bottom: 1rem;
            opacity: 0.8;
        }

        .slide.section-intro h2 {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .slide.section-intro .description {
            font-size: 1.8rem;
            opacity: 0.9;
        }

        /* Question slide */
        .slide.question {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }

        .slide.question .question-content {
            width: 100%;
            max-width: 900px;
            text-align: center;
        }

        .slide.question .prompt {
            font-size: 5rem;
            margin-bottom: 2rem;
            color: #333;
            min-height: 6rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .slide.question .asset-container {
            margin-bottom: 2rem;
        }

        .slide.question .asset-image {
            max-width: 600px;
            max-height: 300px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .slide.question .asset-audio {
            margin: 1rem 0;
        }

        .slide.question audio {
            width: 100%;
            max-width: 400px;
        }

        .slide.question .answer-section {
            margin-top: 2rem;
        }

        .slide.question .reveal-btn {
            padding: 1rem 2.5rem;
            font-size: 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .slide.question .reveal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .slide.question .answer {
            margin-top: 1.5rem;
            font-size: 2.5rem;
            color: #e74c3c;
            font-weight: bold;
            opacity: 0;
            transform: scale(0.9);
            transition: opacity 0.3s ease, transform 0.3s ease;
            max-height: 0;
            overflow: hidden;
        }

        .slide.question .answer.visible {
            opacity: 1;
            transform: scale(1);
            max-height: 300px;
        }

        .slide.question .asset-placeholder {
            padding: 2rem;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            color: #666;
            font-size: 1.2rem;
        }

        /* Ending slide */
        .slide.ending {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
            text-align: center;
        }

        .slide.ending h2 {
            font-size: 4rem;
            margin-bottom: 2rem;
        }

        .slide.ending p {
            font-size: 2rem;
            opacity: 0.9;
        }

        /* Navigation controls */
        .nav-controls {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 1rem;
            align-items: center;
            background: rgba(0, 0, 0, 0.6);
            padding: 1rem 2rem;
            border-radius: 50px;
            backdrop-filter: blur(10px);
            z-index: 1000;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: background 0.2s;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .slide-counter {
            color: white;
            font-size: 1rem;
            min-width: 100px;
            text-align: center;
        }

        /* Progress bar */
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            z-index: 1001;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Click zones for navigation */
        .click-zone {
            position: fixed;
            top: 0;
            bottom: 0;
            width: 20%;
            cursor: pointer;
            z-index: 100;
            transition: background 0.2s;
        }

        .click-zone.left {
            left: 0;
        }

        .click-zone.right {
            right: 0;
        }

        .click-zone:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        /* Logo placeholder */
        .logo-placeholder {
            width: 150px;
            height: 150px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            margin-bottom: 2rem;
        }

        /* Round 2 Specific Modifications */
        .slide.round-2 .prompt {
            display: none;
        }

        .slide.round-2 .asset-image {
            max-width: 900px;
            /* Increased from 600px */
            max-height: 60vh;
            /* Use viewport height instead of fixed pixels */
        }

        .slide.round-2 .question-content {
            margin-top: -3rem;
            /* Move content up */
        }

        .slide.round-2 .asset-container {
            margin-bottom: 2rem;
        }

        /* Round 2: Side-by-Side Layout on Answer Reveal */
        .slide.round-2.answer-visible .question-content {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 4rem;
            margin-top: 0;
            /* Reset margin */
            width: 100%;
            max-width: 1200px;
        }

        .slide.round-2.answer-visible .asset-container {
            margin-bottom: 0;
            flex: 1;
            display: flex;
            justify-content: flex-end;
        }

        .slide.round-2.answer-visible .asset-image {
            max-height: 70vh;
            /* Slightly larger in side-by-side */
            max-width: 100%;
            object-fit: contain;
        }

        .slide.round-2.answer-visible .answer-section {
            flex: 0 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-width: 300px;
            margin-top: 0;
        }

        .slide.round-2.answer-visible .answer {
            font-size: 5rem;
            /* Larger answer text */
            margin-top: 2rem;
            max-height: none;
            /* Override animation restriction */
            transform: none;
            opacity: 1;
        }
    </style>
</head>

<body>
    <!-- File picker overlay -->
    <div id="file-picker-overlay">
        <div class="picker-content">
            <h1>üìÇ Ê¨¢ËøéÊù•Âà∞Áü•ËØÜÈóÆÁ≠î</h1>
            <p>ËØ∑ÈÄâÊã©ÂåÖÂê´È¢òÂ∫ìÁöÑ content Êñá‰ª∂Â§π</p>
            <button class="select-folder-btn" onclick="document.getElementById('folder-input').click()">
                ÈÄâÊã© content Êñá‰ª∂Â§π
            </button>
            <input type="file" id="folder-input" webkitdirectory multiple>
            <div id="error-display" class="error-message"></div>
        </div>
    </div>

    <!-- Presentation container -->
    <div id="presentation-container">
        <!-- Progress bar -->
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>

        <!-- Slide viewport -->
        <div class="slide-viewport">
            <div class="slide-wrapper" id="slide-wrapper">
                <!-- Slides will be dynamically inserted here -->
            </div>
        </div>

        <!-- Navigation controls -->
        <div class="nav-controls">
            <button class="nav-btn" id="prev-btn" onclick="prevSlide()">‚óÄ</button>
            <div class="slide-counter">
                <span id="current-slide">1</span> / <span id="total-slides">1</span>
            </div>
            <button class="nav-btn" id="next-btn" onclick="nextSlide()">‚ñ∂</button>
        </div>

        <!-- Click zones for navigation -->
        <div class="click-zone left" onclick="prevSlide()"></div>
        <div class="click-zone right" onclick="nextSlide()"></div>
    </div>

    <script>
        // ===========================
        // CONFIGURATION & COPY TEXT
        // ===========================
        const COPY = {
            cover: {
                title: "Âπ¥‰ºöÁü•ËØÜÈóÆÁ≠î",
                subtitle: "2026 Êñ∞Êò•ÁâπÂà´Áâà"
            },
            rules: {
                title: "Ê¥ªÂä®ËßÑÂàô",
                items: [
                    "ÂÖ±ÂàÜ‰∏∫Â§ö‰∏™ÁéØËäÇÔºåÊØè‰∏™ÁéØËäÇÊúâ‰∏çÂêåÁ±ªÂûãÁöÑÈ¢òÁõÆ",
                    "ÊØèÈ¢òÂú®Â±èÂπï‰∏äÊòæÁ§∫ÈóÆÈ¢òÔºåÁÇπÂáªÊåâÈíÆÊòæÁ§∫Á≠îÊ°à",
                    "ÂÖ®ÂëòÂèÇ‰∏éÔºåÁ≠îÂØπÊúâÂ•ñ",
                    "Áé©ÂæóÂºÄÂøÉÔºåÁ•ùÂ§ßÂÆ∂Êñ∞Êò•Âø´‰πêÔºÅ"
                ]
            },
            ending: {
                title: "ÊÅ≠ÂñúÂÆåÊàêÊâÄÊúâÈ¢òÁõÆÔºÅ",
                message: "Á•ùÂ§ßÂÆ∂2026Âπ¥‰∏á‰∫ãÂ¶ÇÊÑèÔºåÈæôËÖæËôéË∑ÉÔºÅüéâ"
            }
        };

        // ===========================
        // GLOBAL STATE
        // ===========================
        let contentData = null;
        let slides = [];
        let currentSlideIndex = 0;
        let logoDataUrl = null;

        // ===========================
        // CONTENT LOADING
        // ===========================
        document.getElementById('folder-input').addEventListener('change', async (event) => {
            const files = Array.from(event.target.files);

            if (files.length === 0) {
                showError("Êú™ÈÄâÊã©Êñá‰ª∂Â§π");
                return;
            }

            try {
                await loadContent(files);
                hideFilePicker();
                initPresentation();
            } catch (error) {
                showError(error.message);
            }
        });

        function showError(message) {
            document.getElementById('error-display').textContent = `‚ùå ${message}`;
        }

        function hideFilePicker() {
            document.getElementById('file-picker-overlay').classList.add('hidden');
            document.getElementById('presentation-container').classList.add('active');
        }

        async function loadContent(files) {
            // Find bank.json
            const bankFile = files.find(f => f.name === 'bank.json' || f.webkitRelativePath.endsWith('bank.json'));

            if (!bankFile) {
                throw new Error("Êú™ÊâæÂà∞ bank.json Êñá‰ª∂ÔºåËØ∑Á°Æ‰øùÈÄâÊã©‰∫ÜÊ≠£Á°ÆÁöÑ content Êñá‰ª∂Â§π");
            }

            // Parse bank.json
            const bankText = await bankFile.text();
            try {
                contentData = JSON.parse(bankText);
            } catch (e) {
                throw new Error(`bank.json Ê†ºÂºèÈîôËØØ: ${e.message}`);
            }

            // Validate bank.json structure
            if (!contentData.rounds || !Array.isArray(contentData.rounds)) {
                throw new Error("bank.json Áº∫Â∞ë rounds Êï∞ÁªÑ");
            }

            console.log(`‚úì Âä†ËΩΩÈ¢òÂ∫ìÊàêÂäüÔºåÂÖ± ${contentData.rounds.length} ‰∏™ÁéØËäÇ`);

            // Load logo (try multiple extensions)
            await loadLogo(files);

            // AUTO-DISCOVERY FOR ROUND 2 (image_guess)
            // Look for jpg files in image/round2/ or assets/images/round2/
            const round2 = contentData.rounds.find(r => r.key === 'image_guess' || r.round === 2);
            if (round2) {
                console.log("üîçÊ≠£Âú®Êâ´Êèè Round 2 ÂõæÁâá...");
                const round2Images = files.filter(f => {
                    const path = f.webkitRelativePath || f.name;
                    // Match "image/round2/" or "assets/images/round2/" and ends with .jpg (case insensitive)
                    return (path.includes('image/round2/') || path.includes('assets/images/round2/')) &&
                        /\.jpg$/i.test(f.name);
                });

                if (round2Images.length > 0) {
                    console.log(`‚úì ÂèëÁé∞ ${round2Images.length} Âº† Round 2 ÂõæÁâáÔºåËá™Âä®ÁîüÊàêÈ¢òÁõÆ`);

                    // Sort by filename to ensure consistent order
                    round2Images.sort((a, b) => a.name.localeCompare(b.name));

                    round2.items = round2Images.map((file, index) => {
                        // Extract answer from filename (remove extension)
                        const filename = file.name;
                        const answer = filename.replace(/\.[^/.]+$/, ""); // Remove extension

                        // Get relative path for asset loading
                        // webkitRelativePath is full path like "content/image/round2/foo.jpg"
                        // ensure we pass something loadAsset can handle. 
                        // loadAsset matches by endWith or name, so webkitRelativePath is safe to pass if we want, 
                        // but let's pass the relative path part.
                        // Actually, loadAsset takes 'path', and matches against file.webkitRelativePath.endsWith(path).
                        // So passing "image/round2/foo.jpg" is good.
                        // But since we just need to identify the file, we can use the file object directly if we refactored,
                        // but sticking to existing pattern: logic needs a string path.

                        // We will use the full relative path after the root folder name.
                        // f.webkitRelativePath usually is "Folder/Sub/File.jpg".
                        // We want "Sub/File.jpg" roughly, but our loadAsset checks "endsWith".
                        // So we can just use the filename or a clearer path if unique.
                        // Let's use the path string found in the file object to be safe.

                        return {
                            id: `auto-q2-${index + 1}`,
                            prompt: "ËøôÊòØ‰∏Ä‰∏™Ë∞úËØ≠ÔºåËØ∑ÁúãÂõæÁåúÂ≠ó", // Default prompt
                            answer: answer,
                            asset: file.webkitRelativePath
                        };
                    });
                } else {
                    console.log("‚ö†Ô∏è Êú™ÂèëÁé∞ Round 2 Ëá™Âä®ÂõæÁâá (image/round2/*.jpg)Ôºå‰ΩøÁî® bank.json ÈªòËÆ§È¢òÁõÆ");
                }
            }

            // Store files for asset loading
            window.contentFiles = files;
        }

        async function loadLogo(files) {
            const logoExtensions = ['svg', 'png', 'webp', 'jpg'];

            for (const ext of logoExtensions) {
                const logoFile = files.find(f =>
                    f.name === `logo.${ext}` ||
                    f.webkitRelativePath.endsWith(`logo.${ext}`)
                );

                if (logoFile) {
                    try {
                        logoDataUrl = await readFileAsDataUrl(logoFile);
                        console.log(`‚úì Âä†ËΩΩ logo.${ext} ÊàêÂäü`);
                        return;
                    } catch (e) {
                        console.warn(`Êó†Ê≥ïÂä†ËΩΩ logo.${ext}:`, e);
                    }
                }
            }

            console.log("Êú™ÊâæÂà∞ logo Êñá‰ª∂ÔºåÂ∞Ü‰ΩøÁî®Âç†‰ΩçÁ¨¶");
        }

        function readFileAsDataUrl(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        async function loadAsset(assetPath) {
            if (!window.contentFiles || !assetPath) return null;

            const assetFile = window.contentFiles.find(f =>
                f.webkitRelativePath.endsWith(assetPath) || f.name === assetPath.split('/').pop()
            );

            if (!assetFile) {
                console.warn(`Asset not found: ${assetPath}`);
                return null;
            }

            try {
                return await readFileAsDataUrl(assetFile);
            } catch (e) {
                console.warn(`Failed to load asset ${assetPath}:`, e);
                return null;
            }
        }

        // ===========================
        // SLIDE GENERATION
        // ===========================
        function initPresentation() {
            slides = [];

            // 1. Cover slide
            slides.push({
                type: 'cover',
                content: COPY.cover
            });

            // 2. Rules slide
            slides.push({
                type: 'rules',
                content: COPY.rules
            });

            // 3. Process rounds
            contentData.rounds.forEach((round, roundIndex) => {
                // Section intro slide
                slides.push({
                    type: 'section-intro',
                    round: round,
                    roundNumber: roundIndex + 1
                });

                // Question slides
                if (round.items && Array.isArray(round.items)) {
                    round.items.forEach((item, itemIndex) => {
                        // Validate required fields
                        if (!item.id || !item.prompt) {
                            console.warn(`Skipping invalid question: missing id or prompt`, item);
                            return;
                        }

                        slides.push({
                            type: 'question',
                            question: item,
                            roundNumber: roundIndex + 1,
                            questionNumber: itemIndex + 1
                        });
                    });
                }
            });

            // 4. Ending slide
            slides.push({
                type: 'ending',
                content: COPY.ending
            });

            console.log(`‚úì ÁîüÊàê ${slides.length} Âº†ÂπªÁÅØÁâá`);

            renderSlides();
            updateNavigation();
        }

        async function renderSlides() {
            const wrapper = document.getElementById('slide-wrapper');
            wrapper.innerHTML = '';

            for (let i = 0; i < slides.length; i++) {
                const slide = slides[i];
                const slideElement = await createSlideElement(slide, i);
                wrapper.appendChild(slideElement);
            }

            // Show first slide
            wrapper.children[0].classList.add('active');

            // Update total count
            document.getElementById('total-slides').textContent = slides.length;
        }

        async function createSlideElement(slideData, index) {
            const div = document.createElement('div');
            // Add round-specific class if available (e.g., round-2)
            const roundClass = slideData.roundNumber ? `round-${slideData.roundNumber}` : '';
            div.className = `slide ${slideData.type} ${roundClass}`;
            div.dataset.index = index;

            switch (slideData.type) {
                case 'cover':
                    div.innerHTML = `
            ${logoDataUrl
                            ? `<img src="${logoDataUrl}" alt="Logo" class="logo">`
                            : '<div class="logo-placeholder">üéâ</div>'
                        }
            <h1>${slideData.content.title}</h1>
            <div class="subtitle">${slideData.content.subtitle}</div>
          `;
                    break;

                case 'rules':
                    div.innerHTML = `
            <h2>${slideData.content.title}</h2>
            <ul>
              ${slideData.content.items.map(item => `<li>${item}</li>`).join('')}
            </ul>
          `;
                    break;

                case 'section-intro':
                    const roundTitle = slideData.round.key || `ÁéØËäÇ ${slideData.roundNumber}`;
                    const roundDesc = slideData.round.description || '';
                    div.innerHTML = `
            <div class="round-number">Á¨¨${slideData.roundNumber}ÁéØËäÇ</div>
            <h2>${roundTitle}</h2>
            ${roundDesc ? `<div class="description">${roundDesc}</div>` : ''}
          `;
                    break;

                case 'question':
                    await renderQuestionSlide(div, slideData);
                    break;

                case 'ending':
                    div.innerHTML = `
            <h2>${slideData.content.title}</h2>
            <p>${slideData.content.message}</p>
          `;
                    break;
            }

            return div;
        }

        async function renderQuestionSlide(element, slideData) {
            const question = slideData.question;

            let assetHtml = '';
            if (question.asset) {
                const assetData = await loadAsset(question.asset);

                if (assetData) {
                    // Determine if it's image or audio based on extension
                    const extension = question.asset.split('.').pop().toLowerCase();
                    const imageExts = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg'];
                    const audioExts = ['mp3', 'wav', 'ogg', 'm4a'];

                    if (imageExts.includes(extension)) {
                        assetHtml = `
              <div class="asset-container">
                <img src="${assetData}" alt="Question asset" class="asset-image">
              </div>
            `;
                    } else if (audioExts.includes(extension)) {
                        assetHtml = `
              <div class="asset-container asset-audio">
                <audio controls>
                  <source src="${assetData}">
                  ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅÈü≥È¢ëÊí≠Êîæ
                </audio>
              </div>
            `;
                    }
                } else {
                    assetHtml = `
            <div class="asset-container">
              <div class="asset-placeholder">ËµÑÊ∫êÊú™ÊâæÂà∞: ${question.asset}</div>
            </div>
          `;
                }
            }

            const hasAnswer = question.answer && question.answer.trim().length > 0;
            const answerId = `answer-${question.id}`;
            const btnId = `btn-${question.id}`;

            element.innerHTML = `
        <div class="question-content">
          <div class="prompt">${question.prompt}</div>
          ${assetHtml}
          ${hasAnswer ? `
            <div class="answer-section">
              <button class="reveal-btn" id="${btnId}" onclick="toggleAnswer('${answerId}', '${btnId}')">
                ÊòæÁ§∫Á≠îÊ°à
              </button>
              <div class="answer" id="${answerId}">${question.answer}</div>
            </div>
          ` : ''}
        </div>
      `;
        }

        // ===========================
        // ANSWER TOGGLE
        // ===========================
        function toggleAnswer(answerId, btnId) {
            const answerEl = document.getElementById(answerId);
            const btnEl = document.getElementById(btnId);

            if (!answerEl || !btnEl) return;

            // Find parent slide to toggle layout class
            const slide = btnEl.closest('.slide');

            if (answerEl.classList.contains('visible')) {
                answerEl.classList.remove('visible');
                btnEl.textContent = 'ÊòæÁ§∫Á≠îÊ°à';
                if (slide) slide.classList.remove('answer-visible');
            } else {
                answerEl.classList.add('visible');
                btnEl.textContent = 'ÈöêËóèÁ≠îÊ°à';
                if (slide) slide.classList.add('answer-visible');
            }
        }

        // ===========================
        // NAVIGATION
        // ===========================
        function goToSlide(index) {
            if (index < 0 || index >= slides.length) return;

            const wrapper = document.getElementById('slide-wrapper');
            const allSlides = wrapper.children;

            // Hide current slide
            if (allSlides[currentSlideIndex]) {
                allSlides[currentSlideIndex].classList.remove('active');
                if (index > currentSlideIndex) {
                    allSlides[currentSlideIndex].classList.add('prev');
                } else {
                    allSlides[currentSlideIndex].classList.remove('prev');
                }
            }

            // Show new slide
            currentSlideIndex = index;
            if (allSlides[currentSlideIndex]) {
                allSlides[currentSlideIndex].classList.add('active');
                allSlides[currentSlideIndex].classList.remove('prev');
            }

            updateNavigation();
        }

        function nextSlide() {
            goToSlide(currentSlideIndex + 1);
        }

        function prevSlide() {
            goToSlide(currentSlideIndex - 1);
        }

        function updateNavigation() {
            // Update counter
            document.getElementById('current-slide').textContent = currentSlideIndex + 1;

            // Update buttons
            document.getElementById('prev-btn').disabled = currentSlideIndex === 0;
            document.getElementById('next-btn').disabled = currentSlideIndex === slides.length - 1;

            // Update progress bar
            const progress = ((currentSlideIndex + 1) / slides.length) * 100;
            document.getElementById('progress-fill').style.width = `${progress}%`;
        }

        // ===========================
        // KEYBOARD NAVIGATION
        // ===========================
        document.addEventListener('keydown', (e) => {
            switch (e.key) {
                case 'ArrowRight':
                case ' ':
                case 'PageDown':
                    e.preventDefault();
                    nextSlide();
                    break;
                case 'ArrowLeft':
                case 'PageUp':
                    e.preventDefault();
                    prevSlide();
                    break;
                case 'Home':
                    e.preventDefault();
                    goToSlide(0);
                    break;
                case 'End':
                    e.preventDefault();
                    goToSlide(slides.length - 1);
                    break;
            }
        });
    </script>
</body>

</html>