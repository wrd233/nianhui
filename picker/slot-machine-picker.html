<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿¡é€šå¤§è½¬ç›˜ - å†…éƒ¨æŠ½å¥–ç³»ç»Ÿ</title>
    <meta name="description" content="ä¿¡é€šå…¬å¸å†…éƒ¨éšæœºæŠ½å–äººå‘˜å·¥å…·">
    <style>
        /* ========================================
           CSS æ ·å¼ï¼šç°ä»£å•†åŠ¡é£æ ¼ + è€è™æœºè§†è§‰æ•ˆæœ
           ======================================== */

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #fff;
        }

        /* ä¸»æ ‡é¢˜ */
        .main-title {
            font-size: 3rem;
            font-weight: 700;
            text-align: center;
            margin: 30px 0 40px;
            background: linear-gradient(90deg, #ffd700, #ffaa00, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            letter-spacing: 8px;
        }

        .subtitle {
            font-size: 1rem;
            color: #8892b0;
            margin-top: -30px;
            margin-bottom: 30px;
            letter-spacing: 2px;
        }

        /* ç­›é€‰é¢æ¿ */
        .filter-panel {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .filter-label {
            font-size: 0.9rem;
            color: #ccd6f6;
            font-weight: 500;
        }

        .filter-select {
            padding: 12px 24px;
            font-size: 1rem;
            border: 2px solid #3d5a80;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            cursor: pointer;
            min-width: 160px;
            transition: all 0.3s ease;
        }

        .filter-select:hover:not(:disabled) {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
        }

        .filter-select:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .filter-select option {
            background: #16213e;
            color: #fff;
        }

        /* è€è™æœºå®¹å™¨ */
        .slot-machine {
            background: linear-gradient(180deg, #2d2d44 0%, #1a1a2e 100%);
            border-radius: 20px;
            padding: 30px 40px;
            box-shadow:
                0 0 0 4px #ffd700,
                0 0 0 8px #16213e,
                0 10px 40px rgba(0, 0, 0, 0.5),
                inset 0 2px 10px rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }

        .reels-container {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .reel-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .reel-title {
            font-size: 1rem;
            color: #ffd700;
            margin-bottom: 10px;
            font-weight: 600;
            letter-spacing: 2px;
        }

        /* å•ä¸ªè½¬è½® */
        .reel {
            width: 140px;
            height: 180px;
            background: linear-gradient(180deg, #0a0a15 0%, #1a1a2e 50%, #0a0a15 100%);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            box-shadow:
                inset 0 0 20px rgba(0, 0, 0, 0.8),
                0 4px 15px rgba(0, 0, 0, 0.3);
        }

        /* è½¬è½®å†…å®¹ */
        .reel-content {
            position: absolute;
            width: 100%;
            transition: transform 0.1s linear;
        }

        .reel-item {
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            color: #ccd6f6;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* é«˜äº®ä¸­é—´è¡Œ */
        .reel::before,
        .reel::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 60px;
            pointer-events: none;
            z-index: 10;
        }

        .reel::before {
            top: 0;
            background: linear-gradient(180deg, rgba(26, 26, 46, 0.95) 0%, transparent 100%);
        }

        .reel::after {
            bottom: 0;
            background: linear-gradient(0deg, rgba(26, 26, 46, 0.95) 0%, transparent 100%);
        }

        /* ä¸­é—´é«˜äº®æ¡† */
        .reel-highlight {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 130px;
            height: 56px;
            border: 2px solid #ffd700;
            border-radius: 6px;
            box-shadow:
                0 0 10px rgba(255, 215, 0, 0.3),
                inset 0 0 10px rgba(255, 215, 0, 0.1);
            pointer-events: none;
            z-index: 20;
        }

        /* é”å®šçŠ¶æ€æŒ‡ç¤º */
        .reel.locked {
            opacity: 0.7;
        }

        .reel.locked::before {
            content: 'ğŸ”’';
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.8rem;
            z-index: 25;
            background: none;
            height: auto;
        }

        /* å¼€å§‹æŒ‰é’®ï¼ˆæ‹‰æ†é£æ ¼ï¼‰ */
        .lever-button {
            position: relative;
            margin: 20px 0;
        }

        .start-btn {
            padding: 20px 60px;
            font-size: 1.4rem;
            font-weight: 700;
            color: #1a1a2e;
            background: linear-gradient(180deg, #ffd700 0%, #ffaa00 50%, #ff8c00 100%);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow:
                0 6px 0 #b8860b,
                0 10px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.15s ease;
            letter-spacing: 4px;
            position: relative;
            overflow: hidden;
        }

        .start-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .start-btn:hover:not(:disabled)::before {
            left: 100%;
        }

        .start-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow:
                0 8px 0 #b8860b,
                0 15px 30px rgba(0, 0, 0, 0.4);
        }

        .start-btn:active:not(:disabled) {
            transform: translateY(4px);
            box-shadow:
                0 2px 0 #b8860b,
                0 5px 10px rgba(0, 0, 0, 0.3);
        }

        .start-btn:disabled {
            background: linear-gradient(180deg, #666 0%, #444 100%);
            box-shadow: 0 4px 0 #333;
            cursor: not-allowed;
            color: #999;
        }

        /* ç»“æœæ˜¾ç¤ºåŒº */
        .result-panel {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid #3d5a80;
            border-radius: 15px;
            padding: 25px 40px;
            text-align: center;
            min-width: 400px;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .result-panel.success {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
        }

        .result-label {
            font-size: 1rem;
            color: #8892b0;
            margin-bottom: 15px;
        }

        .result-content {
            font-size: 1.5rem;
            color: #ffd700;
            font-weight: 600;
            letter-spacing: 2px;
        }

        .result-content.empty {
            color: #8892b0;
            font-size: 1.1rem;
        }

        /* æ¶ˆæ¯/é”™è¯¯æç¤ºåŒº */
        .message-area {
            margin-top: 20px;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1rem;
            text-align: center;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .message-area.visible {
            opacity: 1;
        }

        .message-area.error {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid #e74c3c;
            color: #ff6b6b;
        }

        .message-area.info {
            background: rgba(52, 152, 219, 0.2);
            border: 1px solid #3498db;
            color: #5dade2;
        }

        /* åº•éƒ¨ä¿¡æ¯ */
        .footer {
            margin-top: auto;
            padding-top: 40px;
            color: #4a5568;
            font-size: 0.85rem;
        }

        /* å“åº”å¼å¸ƒå±€ */
        @media (max-width: 768px) {
            .main-title {
                font-size: 2rem;
                letter-spacing: 4px;
            }

            .filter-panel {
                gap: 15px;
            }

            .reels-container {
                flex-direction: column;
                align-items: center;
            }

            .reel {
                width: 180px;
            }

            .slot-machine {
                padding: 20px;
            }

            .result-panel {
                min-width: auto;
                width: 100%;
            }

            .start-btn {
                padding: 15px 40px;
                font-size: 1.2rem;
            }
        }

        /* æ—‹è½¬åŠ¨ç”»å…³é”®å¸§ */
        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }
        }

        .spinning .slot-machine {
            animation: pulse 0.5s ease-in-out infinite;
        }
    </style>
</head>

<body>
    <!-- ä¸»æ ‡é¢˜ -->
    <h1 class="main-title">ä¿¡é€šå¤§è½¬ç›˜</h1>
    <p class="subtitle">å†…éƒ¨äººå‘˜éšæœºæŠ½å–ç³»ç»Ÿ</p>

    <!-- ç­›é€‰é¢æ¿ -->
    <div class="filter-panel">
        <div class="filter-group">
            <label class="filter-label" for="deptFilter">éƒ¨é—¨ç­›é€‰</label>
            <select id="deptFilter" class="filter-select">
                <option value="">ä¸é™</option>
            </select>
        </div>
        <div class="filter-group">
            <label class="filter-label" for="genderFilter">æ€§åˆ«ç­›é€‰</label>
            <select id="genderFilter" class="filter-select">
                <option value="">ä¸é™</option>
            </select>
        </div>
    </div>

    <!-- è€è™æœºä¸»ä½“ -->
    <div class="slot-machine">
        <div class="reels-container">
            <!-- éƒ¨é—¨è½¬è½® -->
            <div class="reel-wrapper">
                <div class="reel-title">éƒ¨ é—¨</div>
                <div class="reel" id="reelDept">
                    <div class="reel-content" id="reelDeptContent"></div>
                    <div class="reel-highlight"></div>
                </div>
            </div>
            <!-- æ€§åˆ«è½¬è½® -->
            <div class="reel-wrapper">
                <div class="reel-title">æ€§ åˆ«</div>
                <div class="reel" id="reelGender">
                    <div class="reel-content" id="reelGenderContent"></div>
                    <div class="reel-highlight"></div>
                </div>
            </div>
            <!-- å§“åè½¬è½® -->
            <div class="reel-wrapper">
                <div class="reel-title">å§“ å</div>
                <div class="reel" id="reelName">
                    <div class="reel-content" id="reelNameContent"></div>
                    <div class="reel-highlight"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¼€å§‹æŒ‰é’® -->
    <div class="lever-button">
        <button id="startBtn" class="start-btn">å¼€å§‹æ‘‡å·</button>
    </div>

    <!-- ç»“æœæ˜¾ç¤ºåŒº -->
    <div class="result-panel" id="resultPanel">
        <div class="result-label">æœ¬æ¬¡æŠ½ä¸­äººå‘˜</div>
        <div class="result-content empty" id="resultContent">ç­‰å¾…æŠ½å–...</div>
    </div>

    <!-- æ¶ˆæ¯æç¤ºåŒº -->
    <div class="message-area" id="messageArea"></div>

    <!-- åº•éƒ¨ä¿¡æ¯ -->
    <div class="footer">
        Â© 2026 ä¿¡é€šå…¬å¸ Â· å†…éƒ¨ä½¿ç”¨
    </div>

    <script>
        /* ========================================
           JavaScript é€»è¾‘
           ======================================== */

        // ==========================================
        // æ•°æ®æ¨¡å‹ï¼šä¿¡é€šå…¬å¸äººå‘˜æ•°æ®
        // å¯æ ¹æ®å®é™…éœ€è¦æ›¿æ¢æ­¤æ•°æ®é›†
        // ==========================================
        const people = [
            // ç³»ç»Ÿè¿ç»´éƒ¨
            { department: "ç³»ç»Ÿè¿ç»´éƒ¨", gender: "ç”·", name: "ç³»ç»Ÿè¿ç»´éƒ¨å°æ" },
            { department: "ç³»ç»Ÿè¿ç»´éƒ¨", gender: "å¥³", name: "ç³»ç»Ÿè¿ç»´éƒ¨å°å¼ " },

            // è½¯ä»¶å¼€å‘éƒ¨
            { department: "è½¯ä»¶å¼€å‘éƒ¨", gender: "ç”·", name: "è½¯ä»¶å¼€å‘éƒ¨å°æ" },
            { department: "è½¯ä»¶å¼€å‘éƒ¨", gender: "å¥³", name: "è½¯ä»¶å¼€å‘éƒ¨å°ç‹" },

            // æ™ºèƒ½å·¥ç¨‹éƒ¨
            { department: "æ™ºèƒ½å·¥ç¨‹éƒ¨", gender: "ç”·", name: "æ™ºèƒ½å·¥ç¨‹éƒ¨å°æ" },

            // æ•°æ®è¿è¥éƒ¨
            { department: "æ•°æ®è¿è¥éƒ¨", gender: "å¥³", name: "æ•°æ®è¿è¥éƒ¨å°æ" },

            // æ¸¯èˆªç‰©æµéƒ¨
            { department: "æ¸¯èˆªç‰©æµéƒ¨", gender: "ç”·", name: "æ¸¯èˆªç‰©æµéƒ¨å°æ" },

            // ç»¼åˆåŠå…¬å®¤
            { department: "ç»¼åˆåŠå…¬å®¤", gender: "å¥³", name: "ç»¼åˆåŠå…¬å®¤å°æ" },

            // æŠ€æœ¯ä¸­å¿ƒ
            { department: "æŠ€æœ¯ä¸­å¿ƒ", gender: "ç”·", name: "æŠ€æœ¯ä¸­å¿ƒå°æ" },

            // åå‹¤é‡‡è´­éƒ¨
            { department: "åå‹¤é‡‡è´­éƒ¨", gender: "å¥³", name: "åå‹¤é‡‡è´­éƒ¨å°æ" },

            // è®¡åˆ’è´¢åŠ¡éƒ¨
            { department: "è®¡åˆ’è´¢åŠ¡éƒ¨", gender: "ç”·", name: "è®¡åˆ’è´¢åŠ¡éƒ¨å°æ" },

            // å¸‚åœºéƒ¨
            { department: "å¸‚åœºéƒ¨", gender: "å¥³", name: "å¸‚åœºéƒ¨å°æ" }
        ];

        // ==========================================
        // ä»æ•°æ®ä¸­æå–å”¯ä¸€çš„éƒ¨é—¨å’Œæ€§åˆ«åˆ—è¡¨
        // ==========================================
        const departments = [...new Set(people.map(p => p.department))];
        const genders = [...new Set(people.map(p => p.gender))];

        // ==========================================
        // DOM å…ƒç´ å¼•ç”¨
        // ==========================================
        const deptFilter = document.getElementById('deptFilter');
        const genderFilter = document.getElementById('genderFilter');
        const startBtn = document.getElementById('startBtn');
        const resultPanel = document.getElementById('resultPanel');
        const resultContent = document.getElementById('resultContent');
        const messageArea = document.getElementById('messageArea');

        const reelDept = document.getElementById('reelDept');
        const reelGender = document.getElementById('reelGender');
        const reelName = document.getElementById('reelName');
        const reelDeptContent = document.getElementById('reelDeptContent');
        const reelGenderContent = document.getElementById('reelGenderContent');
        const reelNameContent = document.getElementById('reelNameContent');

        // ==========================================
        // è½¬è½®é…ç½®
        // ==========================================
        const REEL_ITEM_HEIGHT = 60;  // æ¯ä¸ªé¡¹ç›®çš„é«˜åº¦ï¼ˆåƒç´ ï¼‰
        const REEL_VISIBLE_ITEMS = 3; // å¯è§é¡¹ç›®æ•°é‡
        const SPIN_DURATION = 2000;   // åŸºç¡€æ—‹è½¬æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
        const STOP_DELAY = 500;       // å„è½¬è½®ä¹‹é—´çš„åœæ­¢å»¶è¿Ÿ

        // å½“å‰æ—‹è½¬çŠ¶æ€
        let isSpinning = false;
        let selectedPerson = null;

        // ==========================================
        // åˆå§‹åŒ–ï¼šå¡«å……ç­›é€‰ä¸‹æ‹‰æ¡†
        // ==========================================
        function initFilters() {
            // å¡«å……éƒ¨é—¨é€‰é¡¹
            departments.forEach(dept => {
                const option = document.createElement('option');
                option.value = dept;
                option.textContent = dept;
                deptFilter.appendChild(option);
            });

            // å¡«å……æ€§åˆ«é€‰é¡¹
            genders.forEach(gender => {
                const option = document.createElement('option');
                option.value = gender;
                option.textContent = gender;
                genderFilter.appendChild(option);
            });
        }

        // ==========================================
        // ç­›é€‰é€»è¾‘ï¼šæ ¹æ®å½“å‰ç­›é€‰æ¡ä»¶è·å–ç¬¦åˆæ¡ä»¶çš„äººå‘˜
        // ==========================================
        function getEligiblePeople() {
            const selectedDept = deptFilter.value;
            const selectedGender = genderFilter.value;

            return people.filter(person => {
                // å¦‚æœé€‰æ‹©äº†ç‰¹å®šéƒ¨é—¨ï¼Œæ£€æŸ¥æ˜¯å¦åŒ¹é…
                if (selectedDept && person.department !== selectedDept) {
                    return false;
                }
                // å¦‚æœé€‰æ‹©äº†ç‰¹å®šæ€§åˆ«ï¼Œæ£€æŸ¥æ˜¯å¦åŒ¹é…
                if (selectedGender && person.gender !== selectedGender) {
                    return false;
                }
                return true;
            });
        }

        // ==========================================
        // éšæœºé€‰æ‹©é€»è¾‘ï¼ˆæ ¸å¿ƒï¼‰
        // ä½¿ç”¨å‡åŒ€éšæœºç®—æ³•ä»ç¬¦åˆæ¡ä»¶çš„äººå‘˜ä¸­é€‰æ‹©ä¸€äºº
        // ==========================================
        function randomSelectPerson(eligiblePeople) {
            if (eligiblePeople.length === 0) return null;

            // ä½¿ç”¨ Math.random() è¿›è¡Œå‡åŒ€éšæœºé€‰æ‹©
            const randomIndex = Math.floor(Math.random() * eligiblePeople.length);
            return eligiblePeople[randomIndex];
        }

        // ==========================================
        // ç”Ÿæˆè½¬è½®å†…å®¹
        // åˆ›å»ºè¶³å¤Ÿå¤šçš„é¡¹ç›®ä»¥æ”¯æŒæ»šåŠ¨åŠ¨ç”»
        // ==========================================
        function generateReelItems(items, targetValue, reelContent) {
            reelContent.innerHTML = '';

            // ä¸ºäº†å®ç°æ— ç¼æ»šåŠ¨ï¼Œæˆ‘ä»¬éœ€è¦é‡å¤é¡¹ç›®å¤šæ¬¡
            // å¹¶ç¡®ä¿ç›®æ ‡å€¼åœ¨ä¸­é—´ä½ç½®
            const repeatCount = 10;
            const allItems = [];

            for (let i = 0; i < repeatCount; i++) {
                items.forEach(item => {
                    allItems.push(item);
                });
            }

            // éšæœºæ‰“ä¹±é¡ºåºï¼ˆé™¤äº†æœ€åè¦æ˜¾ç¤ºçš„ç›®æ ‡å€¼ï¼‰
            for (let i = allItems.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allItems[i], allItems[j]] = [allItems[j], allItems[i]];
            }

            // ç¡®ä¿ç›®æ ‡å€¼åœ¨åˆé€‚çš„ä½ç½®ï¼ˆç”¨äºæœ€ç»ˆåœæ­¢ï¼‰
            const targetIndex = allItems.length - 2;
            allItems[targetIndex] = targetValue;

            // åˆ›å»º DOM å…ƒç´ 
            allItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'reel-item';
                div.textContent = item;
                reelContent.appendChild(div);
            });

            return targetIndex;
        }

        // ==========================================
        // æ˜¾ç¤ºé”å®šçš„è½¬è½®ï¼ˆå•ä¸ªå€¼ï¼Œä¸æ—‹è½¬ï¼‰
        // ==========================================
        function showLockedReel(value, reelContent) {
            reelContent.innerHTML = '';

            // åˆ›å»ºä¸‰ä¸ªé¡¹ç›®ï¼Œä¸­é—´æ˜¯ç›®æ ‡å€¼
            for (let i = 0; i < 3; i++) {
                const div = document.createElement('div');
                div.className = 'reel-item';
                div.textContent = i === 1 ? value : '';
                reelContent.appendChild(div);
            }

            // å®šä½åˆ°ä¸­é—´
            reelContent.style.transform = `translateY(0px)`;
        }

        // ==========================================
        // è½¬è½®åŠ¨ç”»é€»è¾‘
        // ==========================================
        function animateReel(reelContent, targetIndex, duration, isLocked = false) {
            return new Promise(resolve => {
                if (isLocked) {
                    // é”å®šçš„è½¬è½®ä¸æ—‹è½¬
                    resolve();
                    return;
                }

                const startTime = Date.now();
                const startPos = 0;
                // è®¡ç®—ç›®æ ‡ä½ç½®ï¼ˆä½¿ç›®æ ‡é¡¹ç›®åœ¨ä¸­é—´å¯è§åŒºåŸŸï¼‰
                const targetPos = -((targetIndex - 1) * REEL_ITEM_HEIGHT);

                // åŠ¨ç”»ä¸­é—´ä¼šå¿«é€Ÿæ»šåŠ¨ä¸€æ®µè·ç¦»ï¼Œç„¶åå‡é€Ÿ
                const totalDistance = Math.abs(targetPos) + (REEL_ITEM_HEIGHT * 30);

                function animate() {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);

                    // ä½¿ç”¨ç¼“å‡ºå‡½æ•°å®ç°å‡é€Ÿæ•ˆæœ
                    const easeOut = 1 - Math.pow(1 - progress, 3);

                    // è®¡ç®—å½“å‰ä½ç½®
                    let currentPos;
                    if (progress < 0.7) {
                        // å¿«é€Ÿæ»šåŠ¨é˜¶æ®µ
                        currentPos = -(easeOut * totalDistance * 0.7);
                    } else {
                        // å‡é€Ÿå¹¶ç²¾ç¡®åœåœ¨ç›®æ ‡ä½ç½®
                        const slowProgress = (progress - 0.7) / 0.3;
                        const slowEase = 1 - Math.pow(1 - slowProgress, 2);
                        currentPos = targetPos - (1 - slowEase) * REEL_ITEM_HEIGHT * 3;
                    }

                    // åº”ç”¨å˜æ¢
                    reelContent.style.transform = `translateY(${currentPos}px)`;

                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    } else {
                        // ç¡®ä¿æœ€ç»ˆç²¾ç¡®åœåœ¨ç›®æ ‡ä½ç½®
                        reelContent.style.transform = `translateY(${targetPos}px)`;
                        resolve();
                    }
                }

                requestAnimationFrame(animate);
            });
        }

        // ==========================================
        // æ˜¾ç¤ºæ¶ˆæ¯
        // ==========================================
        function showMessage(message, type = 'error') {
            messageArea.textContent = message;
            messageArea.className = `message-area visible ${type}`;

            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                messageArea.className = 'message-area';
            }, 3000);
        }

        // ==========================================
        // éšè—æ¶ˆæ¯
        // ==========================================
        function hideMessage() {
            messageArea.className = 'message-area';
        }

        // ==========================================
        // æ›´æ–°ç»“æœæ˜¾ç¤º
        // ==========================================
        function updateResult(person) {
            if (person) {
                resultContent.textContent = `${person.department} / ${person.gender} / ${person.name}`;
                resultContent.className = 'result-content';
                resultPanel.className = 'result-panel success';
            } else {
                resultContent.textContent = 'ç­‰å¾…æŠ½å–...';
                resultContent.className = 'result-content empty';
                resultPanel.className = 'result-panel';
            }
        }

        // ==========================================
        // è®¾ç½®æ§ä»¶ç¦ç”¨çŠ¶æ€
        // ==========================================
        function setControlsDisabled(disabled) {
            startBtn.disabled = disabled;
            deptFilter.disabled = disabled;
            genderFilter.disabled = disabled;

            if (disabled) {
                document.body.classList.add('spinning');
            } else {
                document.body.classList.remove('spinning');
            }
        }

        // ==========================================
        // ä¸»æŠ½å¥–é€»è¾‘
        // ==========================================
        async function startSpin() {
            if (isSpinning) return;

            hideMessage();

            // 1. è·å–ç¬¦åˆç­›é€‰æ¡ä»¶çš„äººå‘˜
            const eligiblePeople = getEligiblePeople();

            // 2. æ£€æŸ¥æ˜¯å¦æœ‰å¯æŠ½å–çš„äººå‘˜
            if (eligiblePeople.length === 0) {
                showMessage('å½“å‰ç­›é€‰æ¡ä»¶ä¸‹æ²¡æœ‰å¯æŠ½å–çš„äººå‘˜', 'error');
                return;
            }

            // 3. ã€æ ¸å¿ƒã€‘å…ˆéšæœºé€‰å®šæœ€ç»ˆç»“æœ
            //    è¿™æ˜¯å…³é”®ï¼šåœ¨åŠ¨ç”»å¼€å§‹å‰å°±ç¡®å®šç»“æœï¼ŒåŠ¨ç”»åªæ˜¯è§†è§‰è¡¨æ¼”
            selectedPerson = randomSelectPerson(eligiblePeople);

            // 4. ç¦ç”¨æ§ä»¶ï¼Œå¼€å§‹åŠ¨ç”»
            isSpinning = true;
            setControlsDisabled(true);
            updateResult(null);

            // 5. å‡†å¤‡è½¬è½®æ•°æ®
            const isDeptLocked = deptFilter.value !== '';
            const isGenderLocked = genderFilter.value !== '';

            // è·å–å„åˆ—éœ€è¦æ˜¾ç¤ºçš„é€‰é¡¹åˆ—è¡¨
            const deptList = isDeptLocked ? [selectedPerson.department] : departments;
            const genderList = isGenderLocked ? [selectedPerson.gender] : genders;
            const nameList = eligiblePeople.map(p => p.name);

            // 6. è®¾ç½®è½¬è½®é”å®šçŠ¶æ€çš„è§†è§‰æç¤º
            reelDept.classList.toggle('locked', isDeptLocked);
            reelGender.classList.toggle('locked', isGenderLocked);

            // 7. ç”Ÿæˆè½¬è½®å†…å®¹å¹¶è·å–ç›®æ ‡ä½ç½®
            let deptTargetIndex, genderTargetIndex, nameTargetIndex;

            if (isDeptLocked) {
                // éƒ¨é—¨å·²é”å®šï¼Œæ˜¾ç¤ºå›ºå®šå€¼
                showLockedReel(selectedPerson.department, reelDeptContent);
            } else {
                deptTargetIndex = generateReelItems(deptList, selectedPerson.department, reelDeptContent);
            }

            if (isGenderLocked) {
                // æ€§åˆ«å·²é”å®šï¼Œæ˜¾ç¤ºå›ºå®šå€¼
                showLockedReel(selectedPerson.gender, reelGenderContent);
            } else {
                genderTargetIndex = generateReelItems(genderList, selectedPerson.gender, reelGenderContent);
            }

            // å§“åè½¬è½®å§‹ç»ˆæ—‹è½¬
            nameTargetIndex = generateReelItems(nameList, selectedPerson.name, reelNameContent);

            // 8. æŒ‰é¡ºåºåœæ­¢è½¬è½®ï¼šéƒ¨é—¨ -> æ€§åˆ« -> å§“å
            //    å„è½¬è½®ä¹‹é—´æœ‰å»¶è¿Ÿï¼Œè¥é€ è€è™æœºæ•ˆæœ

            // å¯åŠ¨æ‰€æœ‰è½¬è½®åŠ¨ç”»
            const animations = [];

            // éƒ¨é—¨è½¬è½®
            animations.push(
                animateReel(reelDeptContent, deptTargetIndex, SPIN_DURATION, isDeptLocked)
            );

            // æ€§åˆ«è½¬è½®ï¼ˆå»¶è¿Ÿåœæ­¢ï¼‰
            animations.push(
                new Promise(resolve => {
                    setTimeout(async () => {
                        await animateReel(reelGenderContent, genderTargetIndex, SPIN_DURATION, isGenderLocked);
                        resolve();
                    }, STOP_DELAY);
                })
            );

            // å§“åè½¬è½®ï¼ˆå»¶è¿Ÿæ›´é•¿æ—¶é—´åœæ­¢ï¼‰
            animations.push(
                new Promise(resolve => {
                    setTimeout(async () => {
                        await animateReel(reelNameContent, nameTargetIndex, SPIN_DURATION, false);
                        resolve();
                    }, STOP_DELAY * 2);
                })
            );

            // ç­‰å¾…æ‰€æœ‰åŠ¨ç”»å®Œæˆ
            await Promise.all(animations);

            // 9. åŠ¨ç”»å®Œæˆï¼Œæ˜¾ç¤ºç»“æœ
            updateResult(selectedPerson);

            // 10. æ¢å¤æ§ä»¶
            isSpinning = false;
            setControlsDisabled(false);
        }

        // ==========================================
        // äº‹ä»¶ç»‘å®š
        // ==========================================
        startBtn.addEventListener('click', startSpin);

        // ==========================================
        // åˆå§‹åŒ–åº”ç”¨
        // ==========================================
        initFilters();

        // åˆå§‹åŒ–è½¬è½®æ˜¾ç¤ºï¼ˆæ˜¾ç¤ºå ä½å†…å®¹ï¼‰
        function initReels() {
            // éƒ¨é—¨è½¬è½®
            reelDeptContent.innerHTML = '';
            ['', departments[0] || '-', ''].forEach((item, i) => {
                const div = document.createElement('div');
                div.className = 'reel-item';
                div.textContent = i === 1 ? item : '';
                reelDeptContent.appendChild(div);
            });

            // æ€§åˆ«è½¬è½®
            reelGenderContent.innerHTML = '';
            ['', genders[0] || '-', ''].forEach((item, i) => {
                const div = document.createElement('div');
                div.className = 'reel-item';
                div.textContent = i === 1 ? item : '';
                reelGenderContent.appendChild(div);
            });

            // å§“åè½¬è½®
            reelNameContent.innerHTML = '';
            ['', people[0]?.name || '-', ''].forEach((item, i) => {
                const div = document.createElement('div');
                div.className = 'reel-item';
                div.textContent = i === 1 ? item : '';
                reelNameContent.appendChild(div);
            });
        }

        initReels();
    </script>
</body>

</html>